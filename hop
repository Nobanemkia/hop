-- CT_WhiteScanner_V2.lua
-- 1) Fix lag  2) White screen + timer  3) áº¨n lá»—i teleport
-- 4) Target list  5) Gá»­i webhook (giá»¯ nguyÃªn logic báº¡n Ä‘Æ°a)

repeat task.wait() until game:IsLoaded()

--// Services
local Players     = game:GetService('Players')
local Lighting    = game:GetService('Lighting')
local RunService  = game:GetService('RunService')
local UIS         = game:GetService('UserInputService')
local HttpService = game:GetService('HttpService')
local LP          = Players.LocalPlayer

--==================================================
-- 1) Tá»I Æ¯U Äá»’ Há»ŒA / FIX LAG
--==================================================
pcall(function()
    local rs = settings():GetService('RenderSettings')
    if rs then rs.QualityLevel = Enum.QualityLevel.Level01 end
end)

pcall(function()
    Lighting.GlobalShadows = false
    Lighting.EnvironmentDiffuseScale = 0
    Lighting.EnvironmentSpecularScale = 0
    Lighting.FogEnd = 1000
    Lighting.Brightness = 1
    Lighting.ClockTime = 12
    Lighting.ShadowSoftness = 0

    for _, v in ipairs(Lighting:GetChildren()) do
        if v:IsA('BloomEffect') or v:IsA('SunRaysEffect') or v:IsA('DepthOfFieldEffect')
        or v:IsA('BlurEffect') or v:IsA('ColorCorrectionEffect') then
            pcall(function() v.Enabled = false end)
        end
    end

    local function ensureEffect(cls, name)
        local eff = Lighting:FindFirstChild(name)
        if not eff then
            local bycls = Lighting:FindFirstChildOfClass(cls)
            if bycls then eff = bycls; eff.Name = name
            else eff = Instance.new(cls); eff.Name = name; eff.Parent = Lighting end
        end
        pcall(function() eff.Enabled = false end)
    end

    ensureEffect('SunRaysEffect', 'SunRays')
    ensureEffect('BloomEffect', 'Bloom')
    ensureEffect('DepthOfFieldEffect', 'DepthOfField')
    ensureEffect('BlurEffect', 'Blur')
    ensureEffect('ColorCorrectionEffect', 'ColorCorrection')
end)

pcall(function()
    local Terrain = workspace:FindFirstChildOfClass('Terrain')
    if Terrain then
        Terrain.WaterWaveSize = 0
        Terrain.WaterWaveSpeed = 0
        Terrain.WaterReflectance = 0
        Terrain.WaterTransparency = 1
    end
    workspace.StreamingEnabled = true
    workspace.LevelOfDetail = Enum.ModelLevelOfDetail.Disabled
end)

local okDesc, descs = pcall(workspace.GetDescendants, workspace)
if okDesc and type(descs) == 'table' then
    for _, inst in ipairs(descs) do
        if inst:IsA('BasePart') then
            pcall(function()
                inst.Material = Enum.Material.SmoothPlastic
                inst.CastShadow = false
                inst.Reflectance = 0
            end)
        elseif inst:IsA('ParticleEmitter') or inst:IsA('Trail') or inst:IsA('Fire')
            or inst:IsA('Smoke') or inst:IsA('Sparkles') then
            pcall(function() inst.Enabled = false end)
        elseif inst:IsA('Decal') or inst:IsA('Texture') then
            pcall(function()
                inst.Transparency = 1
                inst.ZIndex = 0
            end)
        elseif inst:IsA('SurfaceAppearance') then
            pcall(function() inst:Destroy() end)
        end
    end
end

print('âœ… ÄÃ£ tá»‘i Æ°u Ä‘á»“ há»a xong!')

--==================================================
-- 2) WHITE SCREEN + TIMER (toggle báº±ng phÃ­m P)
--==================================================
local WHITE_ON_START = true
local TOGGLE_KEY = Enum.KeyCode.P
local WhiteGui, WhiteFrame, TimerLabel, WhiteOn = nil, nil, nil, false
local startTime = tick()

local function ensureWhite()
    if WhiteGui and WhiteGui.Parent then return end
    local pg = nil
    local ok = pcall(function() pg = LP and LP:WaitForChild('PlayerGui', 10) end)
    if not ok or not pg then warn('[WhiteScreen] PlayerGui not found'); return end

    WhiteGui = Instance.new('ScreenGui')
    WhiteGui.Name = 'WhiteOverlay'
    WhiteGui.ResetOnSpawn = false
    WhiteGui.IgnoreGuiInset = true
    WhiteGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    WhiteGui.Parent = pg

    WhiteFrame = Instance.new('Frame')
    WhiteFrame.Size = UDim2.fromScale(1, 1)
    WhiteFrame.BackgroundColor3 = Color3.new(1, 1, 1)
    WhiteFrame.BorderSizePixel = 0
    WhiteFrame.Visible = false
    WhiteFrame.Parent = WhiteGui

    TimerLabel = Instance.new('TextLabel')
    TimerLabel.Size = UDim2.new(0, 300, 0, 100)
    TimerLabel.Position = UDim2.fromScale(0.5, 0.5)
    TimerLabel.AnchorPoint = Vector2.new(0.5, 0.5)
    TimerLabel.BackgroundTransparency = 1
    TimerLabel.Text = '00:00:00'
    TimerLabel.TextColor3 = Color3.new(0, 0, 0)
    TimerLabel.TextSize = 48
    TimerLabel.Font = Enum.Font.GothamBold
    TimerLabel.TextStrokeTransparency = 0.8
    TimerLabel.Parent = WhiteFrame
end

local function setWhite(b)
    if not (WhiteGui and WhiteGui.Parent) then ensureWhite() end
    if not (WhiteGui and WhiteGui.Parent) then return end
    WhiteOn = b and true or false
    if WhiteFrame then WhiteFrame.Visible = WhiteOn end
end

pcall(function()
    UIS.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == TOGGLE_KEY then
            setWhite(not WhiteOn)
        end
    end)
end)

if WHITE_ON_START then setWhite(true) end

task.spawn(function()
    RunService.RenderStepped:Connect(function()
        if TimerLabel then
            local elapsed = tick() - startTime
            local hours = math.floor(elapsed / 3600)
            local minutes = math.floor((elapsed % 3600) / 60)
            local seconds = math.floor(elapsed % 60)
            TimerLabel.Text = string.format('%02d:%02d:%02d', hours, minutes, seconds)
        end
    end)
end)

--==================================================
-- 3) áº¨N Báº¢NG Lá»–I TELEPORT
--==================================================
task.spawn(function()
    while task.wait(3) do
        pcall(function()
            local pg = LP:FindFirstChild('PlayerGui')
            if pg then
                for _, gui in ipairs(pg:GetChildren()) do
                    if gui:IsA('ScreenGui') and gui.Enabled then
                        for _, frame in ipairs(gui:GetDescendants()) do
                            if frame:IsA('Frame') or frame:IsA('ImageLabel') then
                                for _, textObj in ipairs(frame:GetDescendants()) do
                                    if textObj:IsA('TextLabel') or textObj:IsA('TextButton') then
                                        local text = string.lower(textObj.Text or '')
                                        local errorKeywords = { '772' }
                                        local isError = false
                                        for _, kw in ipairs(errorKeywords) do
                                            if text:find(kw) then isError = true break end
                                        end
                                        if isError then
                                            frame.Visible = false
                                            gui.Enabled = false
                                            print('ğŸš« ÄÃ£ áº©n báº£ng lá»—i:', textObj.Text)
                                            for _, btn in ipairs(frame:GetDescendants()) do
                                                if btn:IsA('TextButton') then
                                                    local btnText = string.lower(btn.Text or '')
                                                    if btnText:find('ok') or btnText:find('Ä‘Ã³ng') or btnText:find('close') then
                                                        pcall(function()
                                                            for _, connection in pairs(getconnections(btn.MouseButton1Click)) do
                                                                connection:Fire()
                                                            end
                                                        end)
                                                    end
                                                end
                                            end
                                            break
                                        end
                                    end
                                end
                            end
                        end
                    end
                end

                pcall(function()
                    local coreGui = game:GetService('CoreGui')
                    for _, gui in ipairs(coreGui:GetChildren()) do
                        if gui:IsA('ScreenGui') then
                            for _, desc in ipairs(gui:GetDescendants()) do
                                if desc:IsA('TextLabel') then
                                    local text = string.lower(desc.Text or '')
                                    if text:find('772') or text:find('773') then
                                        gui.Enabled = false
                                    end
                                end
                            end
                        end
                    end
                end)
            end
        end)
    end
end)

--==================================================
-- 4) TARGET LIST
--==================================================
local targets = {
    'Chipso and Queso','La Casa Boo','Tang Tang Keletang','Headless Horseman',
    'Burrito Bandito','Strawberry Elephant','Chicleteira Bicicleteira','Los Chicleteiras',
    'La Grande Combinasion','Nuclearo Dinossauro','Esok Sekolah','Ketupat Kepat',
    'Money Money Puggy','Tictac Sahur','Ketchuru and Musturu','Garama and Madundung',
    'Spaghetti Tualetti','Dragon Cannelloni','67','Mariachi Corazoni','Tacorita Bicicleta',
    'La Extinct Grande','Quesadilla Crocodila','Los Nooo My Hotspotsitos','Las Sis',
    'Celularcini Viciosini','Los Bros','Tralaledon','Los Tacoritas','Los Primos',
    'Chillin Chili','Los Combinasionas','Los Hotspotsitos','La Supreme Combinasion',
    'Los 67','La Secret Combinasion','Burguro And Fryuro','La Spooky Grande','Los Mobilis',
    'Eviledon','Spooky and Pumpky','Mieteteira Bicicleteira','Los Spooky Combinasionas','Meowl',
    'Los Matteos','Bisonte Giuppitere','La Vacca Saturno Saturnita','Torrtuginni Dragonfrutini',
    'Los Tralaleritos','Los Spyderinis','Las Tralaleritas','Job Job Job Sahur','Noo my examine',
    'Las Vaquitas Saturnitas','To to to Sahur',

}

--==================================================
-- 5) Gá»¬I WEBHOOK (giá»¯ NGUYÃŠN logic báº¡n Ä‘Æ°a)
--==================================================
local urls = {
    low = {
        'https://discord.com/api/webhooks/1432680719393624135/CbeXxo7BT00ScPG8sBddhMkxCBBWzL431RvFclSqXZm1OXaxurOUWA-vUqt8iG1zc_wE',
        'https://discord.com/api/webhooks/1426862131856412692/J-zZnc1SmoilRJLLU7gACiwH2No_kUfywubRLkAU2XfsLdFAjgmolpTTCk6RbtSE8VJg'
    },
    high = {
        'https://discord.com/api/webhooks/1422467805558865942/lYqd7SPFk5nftbg_L9hrmJ4cAHgnXe7jJbw9H0ti0EQAaiMKh2eGWtpCfCTBZc8pKbzO',
        'https://discord.com/api/webhooks/1426864245143900202/bnRk09C0FuWUKrsx6HFakrgl5UC6ihPHWIrxRknE4VKDH7z-PAzWUvcLXrDwL4LsO9Yy'
    }
}

local http_request = http_request or request or (syn and syn.request)
local lastJobIdSent = nil

local function sendWebhook(foundTargets)
    if not foundTargets or #foundTargets == 0 then return end

    local placeId = game.PlaceId
    local jobId = game.JobId
    if jobId == lastJobIdSent then return end
    lastJobIdSent = jobId

    local joinScript = "game:GetService('TeleportService'):TeleportToPlaceInstance("..placeId..", '"..jobId.."', game.Players.LocalPlayer)"
    local joinLink = 'https://chillihub1.github.io/chillihub-joiner/?placeId='..placeId..'&gameInstanceId='..jobId

    -- ğŸ¯ Chia nhÃ³m theo generation
local lowGroup, highGroup = {}, {}
for _, target in ipairs(foundTargets) do
    local gen = tonumber(target.generation:match("%d+")) or 0
    if gen >= 10 then
        table.insert(highGroup, target)
    elseif gen > 0 then
        table.insert(lowGroup, target)
    end
end

-- âš™ï¸ HÃ m gá»­i payload (giá»¯ nguyÃªn form gá»‘c)
local function sendToUrls(urlGroup, titleText, targetList)
    local payload = {
        ['embeds'] = {
            {
                ['title'] = titleText,
                ['description'] = targetList,
                ['color'] = 0x00FF00,
                ['fields'] = {
                    {
                        ['name'] = 'ğŸ‘¥ Players',
                        ['value'] = tostring(#Players:GetPlayers())
                            .. ' / '
                            .. tostring(Players.MaxPlayers),
                        ['inline'] = true,
                    },
                    {
                        ['name'] = 'ğŸ†” JobId',
                        ['value'] = '`' .. jobId .. '`',
                        ['inline'] = false,
                    },
                    {
                        ['name'] = 'ğŸŒ Join Link',
                        ['value'] = '[Join Server](' .. joinLink .. ')',
                        ['inline'] = false,
                    },
                    {
                        ['name'] = 'ğŸ“œ Join Script',
                        ['value'] = '```lua\n' .. joinScript .. '\n```',
                        ['inline'] = false,
                    },
                },
                ['footer'] = {
                    ['text'] = 'Spyder Scanner | User: ' .. Players.LocalPlayer.Name,
                },
                ['timestamp'] = DateTime.now():ToIsoDate(),
            },
        },
    }

    print('ğŸ“¤ [WEBHOOK] Äang gá»­i:', titleText)
    for i, url in ipairs(urlGroup) do
        task.delay(0.3 * (i - 1), function()
            local success, result = pcall(function()
                return http_request({
                    Url = url,
                    Method = 'POST',
                    Headers = { ['Content-Type'] = 'application/json' },
                    Body = HttpService:JSONEncode(payload),
                })
            end)
            if success then
                print('âœ… [WEBHOOK] Gá»­i thÃ nh cÃ´ng â†’', url)
            else
                print('âŒ [WEBHOOK] Lá»—i gá»­i:', url, tostring(result))
            end
        end)
    end
end

-- ğŸ¯ Gá»­i tá»«ng nhÃ³m riÃªng biá»‡t
if #lowGroup > 0 then
    local list = ''
    for i, t in ipairs(lowGroup) do
        list = list .. 'âœ… ' .. t.name .. ' [ ' .. t.generation .. ' ]'
        if i < #lowGroup then list = list .. '\n' end
    end
    sendToUrls(urls.low, 'ğŸ¯ Target 1â€“9M Detected', list)
end

if #highGroup > 0 then
    local list = ''
    for i, t in ipairs(highGroup) do
        list = list .. 'ğŸ’ ' .. t.name .. ' [ ' .. t.generation .. ' ]'
        if i < #highGroup then list = list .. '\n' end
    end
    task.delay(0.5, function()
        sendToUrls(urls.high, 'ğŸ’ Target 10M+ Detected', list)
    end)
end


--==================================================
-- CHECK TARGETS + LOOP
--==================================================
local function checkTargets()
    local foundTargets = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA('TextLabel') and obj.Name == 'DisplayName' then
            -- âœ… Æ¯u tiÃªn láº¥y Text trÆ°á»›c, náº¿u rá»—ng má»›i dÃ¹ng LocalizedText
            local txt = string.lower(obj.Text or obj.LocalizedText or "")

            if string.upper(obj.Text or obj.LocalizedText or "") == 'FUSING' then
                continue
            end

            for _, name in ipairs(targets) do
                if txt:find(string.lower(name)) then
                    local parent = obj.Parent
                    local isStolen = false
                    local generation = 'N/A'

                    if parent then
                        local stolenLabel = parent:FindFirstChild('Stolen')
                        if stolenLabel and stolenLabel:IsA('TextLabel') then
                            local stolenText = string.upper(stolenLabel.Text or stolenLabel.LocalizedText or '')
                            if stolenText == 'FUSING' then
                                isStolen = true
                            end
                        end

                        for _, child in ipairs(parent:GetChildren()) do
                            if child:IsA('TextLabel') then
                                local childName = string.lower(child.Name or '')
                                local childText = child.Text or child.LocalizedText or ''

                                if childName:find('generation') or childName:find('gen') then
                                    generation = childText ~= '' and childText or generation
                                    break
                                end

                                if childText:match('^G%d+') or childText:match('^G%d+%s') then
                                    generation = childText
                                    break
                                end
                            end
                        end
                    end

                    if not isStolen then
                        table.insert(foundTargets, { name = name, generation = generation })
                        print('âœ… Found valid target:', name, '| Generation:', generation)
                    else
                        print('âš ï¸ Skipped (FUSING):', name)
                    end
                    break
                end
            end
        end
    end
    return foundTargets
end

print('ğŸ¯ CT_WhiteScanner_V2 Ä‘ang cháº¡y... (quÃ©t má»—i 3s)')

-- âœ… CHáº Y NGAY Láº¦N Äáº¦U KHI EXECUTE
local initialTargets = checkTargets()
if #initialTargets > 0 then
    sendWebhook(initialTargets)
else
    print('âŒ› ChÆ°a phÃ¡t hiá»‡n target nÃ o khi khá»Ÿi Ä‘á»™ng.')
end

-- ğŸ” LOOP QUÃ‰T Má»–I 3 GIÃ‚Y
task.spawn(function()
    while task.wait(3) do
        local ok2, err = pcall(function()
            local t = checkTargets()
            if #t > 0 then sendWebhook(t) end
        end)
        if not ok2 then warn('âš ï¸ Scan loop error:', err) end
    end
end)

-- ğŸ•’ SAU 3 GIÃ‚Y â†’ Tá»° Äá»˜NG LOAD SCRIPT WEBSOCKET
task.delay(3, function()
    local url = "https://raw.githubusercontent.com/ducquach123/hopserver/refs/heads/main/websocket"
    print("ğŸŒ Äang táº£i websocket script sau 3s...")
    local success, result = pcall(function()
        loadstring(game:HttpGet(url))()
    end)
    if success then
        print("âœ… Websocket script loaded thÃ nh cÃ´ng!")
    else
        warn("âŒ Lá»—i khi load websocket script:", result)
    end
end)
